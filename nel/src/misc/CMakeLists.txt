FILE(GLOB SRC *.cpp config_file/*.cpp)

DECORATE_NEL_LIB("nelmisc")

IF(NOT WIN32)
  ADD_LIBRARY(${LIBNAME} SHARED ${SRC})
ELSE(NOT WIN32)
  ADD_LIBRARY(${LIBNAME} STATIC ${SRC})
ENDIF(NOT WIN32)

IF(WITH_GTK)
  IF(GTK_FOUND)
    INCLUDE_DIRECTORIES(${GTK_INCLUDE_DIR})
    ADD_DEFINITIONS(-DNL_USE_GTK)
    TARGET_LINK_LIBRARIES(${LIBNAME} ${GTK_LIBRARIES})
  ENDIF(GTK_FOUND)
ENDIF(WITH_GTK)

INCLUDE_DIRECTORIES(${LIBXML2_INCLUDE_DIR})
TARGET_LINK_LIBRARIES(${LIBNAME} ${LIBXML2_LIBRARIES} ${WINSOCK2_LIB})
SET_TARGET_PROPERTIES(${LIBNAME} PROPERTIES VERSION ${NL_VERSION})

IF(WIN32)
  SET_TARGET_PROPERTIES(${LIBNAME} PROPERTIES COMPILE_FLAGS "/Yustdmisc.h")
  SET_SOURCE_FILES_PROPERTIES(stdmisc.cpp PROPERTIES COMPILE_FLAGS "/Ycstdmisc.h")
  SET_TARGET_PROPERTIES(${LIBNAME} PROPERTIES LINK_FLAGS "/NODEFAULTLIB:libcmt")
ENDIF(WIN32)

ADD_DEFINITIONS(${LIBXML2_DEFINITIONS})

INSTALL(TARGETS ${LIBNAME} LIBRARY DESTINATION lib ARCHIVE DESTINATION lib)
